<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta content="en-us" http-equiv="Content-Language">
	
	<title>Madrid Tree</title>
	<meta name="author" content="Guenter Richter" />
	<meta name="description" content="ixmaps iteractive map to explore airbnb listigs in venice,italy" />
	<meta name="keywords" content="ixmaps,airbnb,inside,listings,map,char,interactice,SVG" />
	<meta name="Resource-type" content="Document" />

	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="assets/css/jquery.fullPage.css" />
	<link rel="stylesheet" type="text/css" href="index.css" />
    <link href="assets/css/icomoon.css" rel="stylesheet" />    
	<link href="assets/css/font-awesome.min.css" rel="stylesheet" />
	<style type="text/css">

		body {
			-webkit-user-select: none;
			/* Chrome all / Safari all */
			-moz-user-select: none;
			/* Firefox all */
			-ms-user-select: none;
			/* IE 10+ */
			user-select: none;
			/* Likely future */
		}

		.story-body{
			background-color: rgba(255,255,255,0.1);
			color: #D99191;
		}
		.shareBtns a {
			color: #ddd;
		}
		.shareIcon {
			font-size: 32px;
		}
		a {
			color: #aaa;
		}
		.footer {
		}
		.footer p {
			background-color: rgba(235,235,235,0.7);
			padding: 0.8em;
		}
		.footer a {
			color: #428bca;
		}
		.inline-legend{
			background-color: rgba(235,235,235,0.7);
		}
		.title{
			font-size: 2.5em;
			background-color: rgba(255,255,255,0.5);
			margin-top:2em;
			letter-spacing:-2px;
		}
		div.title{
			font-size: 1.8em;
			font-weight: 500;
			background-color: rgba(255,255,255,0.5);
			margin-top:0em;
		}
		.inline-legend-tool-button{	
			color:#666666;
			xxbackground:#ffffff;
			padding:0.4em;
		}
		.navbar-pad-original {
			-moz-box-shadow: 0px 2px 10px /*{global-box-shadow-size}*/ 			rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
			-webkit-box-shadow: 0px 2px 10px /*{global-box-shadow-size}*/ 		rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
			box-shadow: 0px 2px 10px /*{global-box-shadow-size}*/ 				rgba(0,0,0,.2) /*{global-box-shadow-color}*/ ;
			xxborder-bottom: solid #ddd 1px;
		}
		.shareBtns {
			font-size:8px;
		}
		@media (min-width: 400px) {
			.shareBtns {
				font-size:24px;
			}
		}
		@media (max-width: 400px) {
			body {
				font-size:10px;
			}
			.container {
				margin-top: 1em;
			}
		}
		.title {
			xxfont-family: Roboto,Helvetica;
			color: RGB(148,148,148);
		}
		h1,h2,h3 {
			margin-top: 0em;
		}
		.data-dynamic{
			font-family: courier new,Raleway,arial,helvetica;
		}
		.data-dynamic.btn{
			xborder: #888 solid 1px;
			width: 95%;
			font-weight: 700;
			font-size: 2em;
			text-align: left;
			padding: 0.25em 0;
		}

	</style>

</head>
<body class="story-body">

	<div id="header" class="navbar-fixed-top"  style="position:fixed;top:0;left:-0.5em;width:100%;height:40px;padding:0px 0px 65px 0px;background:#ffffff;z-index:9999" >
		<div class="container" style="margin-top:1.2em" >
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<div class="header" aria-hidden="true">
						<div class="linkSocialContainer" style="float:left">
							<span class="linkContainer"></span>
							<span class="shareBtns" >
								<a href="javascript:ixmaps.popupShare()">
								<span class="shareIcon fa fa-share fa-fw" title="share actual map" ></span></a>
								<a href="javascript:ixmaps.loadStoryTool('./filter.html',{frame:true})" >
								<i class="shareIcon blackHover share_bitly icon-filter" title="Filter" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./layer.html')" >
								<i class="shareIcon blackHover share_bitly icon-map" title="Layer" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./about.html')" >
								<i class="shareIcon blackHover share_bitly icon-info" title="About" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./menu.html')" >
								<i class="shareIcon blackHover share_bitly icon-list2" title="Menu" tabindex="-1" style="margin-left:0.1em" ></i></a>
								<a href="javascript:ixmaps.loadStoryTool('./table.html',{frame:true})" >
								<i class="shareIcon blackHover share_bitly icon-table2" title="Menu" tabindex="-1" style="margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.embeddedApi.embeddedApi.mapTool('selectrect');" >
								<i class="shareIcon blackHover share_bitly icon-insert-template" title="select items on map" tabindex="-1" style="font-size:1.3em;margin-left:0.2em" ></i></a>
								<a href="javascript:ixmaps.embeddedApi.embeddedApi.mapTool('selectrect');" >
								<img src="./resources/images/cursor-select-icon.png" style="height:1.3em;vertical-align:-3px;margin-left:0.2em;opacity:0.4">	
								</a>
							</span>
						</div>
						<div class="linkSocialContainer" style="float:right;margin-right:-0.5em;margin-top:0.2em;">
							<span class="linkContainer"></span>
							<span class="shareBtns" style="font-size:18px">
									<a href="javascript:ixmaps.fullScreen()">
								<i class="shareIcon blackHover share_bitly icon-close" title="Info" tabindex="-1" style="margin-left:0.2em" ></i></a>
							</span>
						</div>
						<div class="logoContainer" style="float:right;margin-right:-10px;display:none">
							<table>
								<tr>
									<td class="logoWrapper">
										<a class="logoLink" target="_blank" tabindex="-1">
											<img class="logoImg" src="" height="60px" style="opacity:0.8"/>
										</a>
									</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>	

	<div id="fullpage" style="display:none">

		<div class="section" >

			<!-- incidenti -->

			<div class="slide container"  style="background:rgba(255,255,255,0.8);">
				<div class="intro down">
					<h3 class="title">MADRID TREES</h3>
					<p style="font-size:1.5em;line-height:1em">Some maps to explore the trees of Madrid</p>
					<p>
					</p>
					
				    <h3 style="padding-bottom:0.5em;">Population and Trees</h3>				
                     <div class="row" style="padding-bottom:1em;">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <a href="#">
                                <div class="card summary-inline">
                                    <div class="card-body">
                                        <i class="icon fa fa-user fa-4x"></i> <span style="font-size:1.2em">Population</span>
                                        <div class="content">
                                            <div class="title data-dynamic btn" style="color:red" data-path="data::population::number">--</div>
                                            <div class="sub-title data-dynamic">in 2019</div>
                                        </div>
                                        <div class="clear-both"></div>
                                    </div>
                                </div>
                            </a>
                        </div>
					   
						<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
							<a href="#">
								<div class="card summary-inline">
									<div class="card-body">
										<i class="icon fa fa-pagelines fa-4x"></i> <span style="font-size:1.5em">Tree Biomass</span>
										<div class="content">
											<div class="title data-dynamic btn" style="color:RGB(138, 181, 81)" data-path="data::trees::weight">--</div>
											<div class="sub-title data-dynamic">biomass above and below earth</div>
										</div>
										<div class="clear-both"></div>
									</div>
								</div>
							</a>
						</div>
					   
					   
						<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6">
							<a href="#">
								<div class="card summary-inline">
									<div class="card-body">
										<span style="font-size:3em">CO<sub>2</sub></span> <span style="font-size:1.2em">sequestered</span>
										<div class="content">
											<div class="title data-dynamic btn" style="color:RGB(144, 144, 144)" data-path="data::trees::co2">--</div>
											<div class="sub-title data-dynamic">total CO<sub>2</sub> sequestration</div>
										</div>
										<div class="clear-both"></div>
									</div>
								</div>
							</a>
						</div>

						<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6">
							<a href="#">
								<div class="card summary-inline">
									<div class="card-body">
										<span style="font-size:3em">CO<sub>2</sub></span> <span style="font-size:1.2em">seq./year</span>
										<div class="content">
											<div class="title data-dynamic btn" data-path="data::trees::co2/year">--</div>
											<div class="sub-title data-dynamic">yearly CO<sub>2</sub> sequestration</div>
										</div>
										<div class="clear-both"></div>
									</div>
								</div>
							</a>
						</div>

					</div>
					<p style="font-size:1.5em;line-height:1em;margin:0.5em 3em 0em 0em">Population density by neighborhoods (barrios), number of inhabitants (circles) and tree weight (biomass)</p>
					<p style="font-size:1.5em;line-height:1em;margin:0em 5em 0em 0em">Please <b>zoom and pan</b> the map to see more details and the above values recalculated from within the actual map bounds.</p>
					<p><b>scroll down</b> for more visualizations </p>
					<div id="user_legendxx" style="color:green"></div>

				</div>
			</div>

		</div>
		<div class="section">

			<!-- incidenti -->

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">Trees by species</h1>
					<p></p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/specie/ixmaps_project_Trees_by_Type_and_Crown_Size.json","replacetheme");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Trees_by_Type_and_Crown_Size.png" width="45%"><img/>
						</a>	
					</p>
					<p class="click-splash">(click on the image to see the map)</p>
					
				</div>
			</div>

		</div>
	
		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">Trees with allergenic pollen</h1>
					<p></p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/specie/ixmaps_project_Trees_by_Type_and_Crown_Size_allergenici_lite.json","replacetheme");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Trees_by_Type_and_Crown_Size_allergenici_lite.png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">micro-climate by trees</h1>
					<p>pseudo color hot/cold image with tree weight/area</p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/tree density/ixmaps_project_Madrid_Trees_weight_grid3px_spectrum.json","replacetheme");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Madrid_Trees_weight_grid3px_spectrum.png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">tree age</h1>
					<p></p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/qualities/ixmaps_project_Madrid_tree_age.json","replacetheme");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Madrid_tree_age.png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">tree age(estimated)</h1>
					<p></p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/qualities/ixmaps_project_Madrid_tree_age_estimated.json","replacetheme");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Madrid_tree_age.png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">green index</h1>
					<p>map trees on green index</p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/green_index/ixmaps_project_Green_Index_Planeamiento (1).json","keepview");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Green_Index_Planeamiento (1).png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">Data integrity</h1>
					<p>trees with very large perimeter</p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/integrity test/ixmaps_project_Madrid_tree_with_perimeter_gt_4.json");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Madrid_tree_with_perimeter_gt_4.png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container" style="background:rgba(255,255,255,0.8);">
				<div class="intro up down">
					<h1 class="title">Data integrity</h1>
					<p>double serial number entries in data base</p>
					<p>
						<a href='javascript:ixmaps.map().loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/integrity test/ixmaps_project_Madrid_tree_show_double_entries.json");'>
						<img src="../../projects/Madrid_final_dyn/img/tiles/ixmaps_project_Madrid_tree_show_double_entries.png" width="45%"><img/>
						</a>	
					</p>
				</div>
			</div>

		</div>

		<div class="section">

			<div class="slide container">
				<div class="intro up down">
					<h1 class="title">Used Data</h1>
					<h3>shapes</h3>
					<br>
					<h4>idrografia.geojson</h4>
					<a href="https://datos.comunidad.madrid/catalogo/dataset/spacmbta10000hidrograflin2011">SIGI_BTA_10M_HIDROGRAF_LIN_11</a> datos.comunidad.madrid CC BY 4.0
					
					<br><br>

					<h4>Divisiones administrativas</h4>
					<h4>Barrios</h4>
						via GreeMta challenge from<br>
						<a href="https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=46b55cde99be2410VgnVCM1000000b205a0aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default" target="_blank">datos.comunidad.madrid</a> CC BY 4.0
					
					<h4>secciones_censales</h4>
					
						from <br>
						<a href="https://datos.comunidad.madrid/catalogo/dataset/secciones_censales/resource/b9580bb1-6449-483c-9bcb-10373cabf32a" target="_blank">datos.comunidad.madrid</a> CC BY 4.0

					<br><br>
					
					<h4>Green Areas</h4>
					
						provided by GreeMta challenge  

					<h4>Normalized Vegetation Index</h4>
					
						via GreeMta challenge from 
						<a href="https://geoportal.madrid.es/IDEAM_WBGEOPORTAL/dataset.iam?id=c02e181e-6d78-11e9-a351-40a8f0462086" target="_blank">geoportal.madrid.es</a> CC BY 4.0

					<br><br>
					
					<h1>data</h1>
					
					<h4>trees</h4>

						Data provided by GreeMta challenge → trees_madrid.zip
						green index  by GreeMta challenge
					
					<br>
					<h4>population</h4>
					<h4>Barrios</h4>
						socio-demographic indicators suggested by GreeMta challenge
						Panel de indicadores de distritos y barrios de Madrid. Estudio sociodemográfico
						https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=71359583a773a510VgnVCM2000001f4a900aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default

					<h4>secciones_censales</h4>
						Rango_Edades_Seccion_202011
						prep: sums per section 
					
					<br><br>
						
					<h1>methods</h1>
						
					<h4>clean data
					</h4>
						find double serial Numbers and remove<br>
						find oversize trees and remove
					<h4>enrich data
					</h4>
						calculate crown area, tree weight (biomass), Co2 value, age, CO2 / year
						qualify: class (conifere,latifogli), allergens. 
					
					<br><br>
					<h4>calculate the tree weight:</h4><br>
						
						to calculate the tree weight a 'Diameter-based Biomass Regressions' method is used. This method is mentioned an valuated also in the following paper:
						<br><br>
						“URBAN FORESTRY E STIMA DEL CARBONIO: ANALISI DI LINEE GUIDA E CALCOLO IN ZONA URBANA COME APPLICAZIONE ED OPPORTUNITÀ PER L’ UNIVERSITÀ DI PADOVA” 
						TESI DI LAUREA IN: “TECNOLOGIE FORESTALI ED AMBIENTALI”
						<br><br>
						UNIVERSITÀ DEGLI STUDI DI PADOVA FACOLTÀ DI AGRARIA Dipartimento Territorio e Sistemi Agro-forestali 
						<br><br>
						Capitolo 5.2 Materiali e metodi, pagina 95
						<br><br>
						the method is originally illustrated in the paper:
						<br><br>
						"Comprehensive Database of Diameter-based Biomass Regressions for North American Tree Species"<br>
						Jennifer C. Jenkins David C. Chojnacky Linda S. Heath Richard A. Birdsey  2003<br> 
						United States Department of Agriculture<br>
					
					<br>here is how it is implemented in this application

					<pre style="padding:0.5em">
Parameters and equations for estimating total above ground biomass
for all hardwood and softwood species in the United States
(from Jenkins et al. 2003)

	bm = Exp( β0 +  β1 ln dbh)
where 
	bm = total above ground biomass (kg) for trees 2.5 cm and larger
	dbh = diameter at breast height (cm) 
	Exp = exponential function 
	ln = natural log base "e" (2.718282) 

choosing the following wood type depending parameters
                β0          β1
Mixed hardwood  -2.4800     2.4835 
Mixed softwood  -2.0336     2.2592 
Pine            -2.5356     2.4349 

total biomass total = Biomass above ground * 1.2 * 0.725
					</pre>
					the total biomass is used to estimate the amount of Carbon Dioxide sequestered by the tree during his growth 
					<pre style="padding:0.5em">
CO2 sequestration:
total biomass * 0.5 * 3.667 
					</pre>
					to estimate the annual CO<sub>2</sub> sequestration of tree, we need its age. This is a very difficult question which I can only solve very approximately 
					<pre style="padding:0.5em">

calculate tree age: 
perimeter in inch * median growth factor (4.5)
median growth from most relevant species: Olmo:4, Platano: 4, Alce:5, Pino: 5 = ca 4.5

					</pre>
					<p>
					
					
					
					
					
					
					</p>
				</div>
			</div>

		</div>

		<div class="section">
			<div class="intro footer up">
				<br>
				<br>
				<br>
				<br>
				<h2>Attributions</h2>
				<br>
				<br>
				<p>Data:<br>
				<a href='https://datos.madrid.es' target='_blank'>City of Madrid - Open Data Madrid - CC BY 4.0</a></p>
				<br>
				<p>Visualization:<br>
				created by <a href="http://ixmaps.com">iXmaps</a> - CC BY</p>
				<p> <span class="icon icon-envelop"></span> <a href="#"> info@ixmaps.com</a> <br/>
					<span class="icon icon-twitter"></span> <a href="#"> @grichter </a> <br/>
				</p>
				<br>
				<p>credits</p>
				<p>
					<a href="http://alvarotrigo.com/fullPage/">alvarotrigo.com</a> - for the scrolling
				<br><a href="http://icomoon.io">icomoon.io</a> - for the nice icons
				</p>

			</div>
		</div>

	</div>


	<!-- ==== MODAL DIALOG ==== -->
	<div id="modal-dialog-1" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="z-index:9999">
	  <div class="modal-dialog modal-lg">
		  <div class="modal-content">
			...
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
	  </div>
	</div>
	<div id="modal-dialog-2" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="z-index:9999">
	  <div class="modal-dialog modal-lg">
		  <div class="modal-content">
			...
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
	  </div>
	</div>
	<div id="modal-dialog-3" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="white;z-index:9999">
	  <div class="modal-dialog modal-lg">
		  <div class="modal-content">
			...
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
	  </div>
	</div>

	<!--[if IE]>
		<script type="text/javascript">
			 var console = { log: function() {} };
		</script>
	<![endif]-->

 	<script type="text/javascript" src="assets/plugins/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/main.js"></script>
	<script type="text/javascript" src="assets/js/masonry.pkgd.min.js"></script>
	<script type="text/javascript" src="assets/js/imagesloaded.js"></script>
    <script type="text/javascript" src="assets/js/classie.js"></script>
	<script type="text/javascript" src="assets/js/AnimOnScroll.js"></script>

	<script type="text/javascript" src="assets/plugins/scrolloverflow.js"></script>

	<script type="text/javascript" src="assets/plugins/jquery.fullPage.min.js"></script>

	<script src="https://gjrichter.github.io/data.min.js/data.js"></script>

	<script type="text/javascript">

 		// --------------------------------
		// get ixmaps API from parent 
		// --------------------------------
		
		var ixmaps = null;
		if ( window.opener ){
			ixmaps = window.opener.ixmaps;
		}else
		if ( parent ){
			ixmaps = parent.window.ixmaps;
		}
		else{
			alert("error: missing parent window for themes !");
		}

		ixmaps.initialized = false;

		// don't synchronise multiple map frames
		ixmaps.setSyncMultiMaps(false);

		var nLegendDiv = 0;
		var legendA = Array(0);
		ixmaps.setLegendDiv = function(n){
			nLegendDiv = n;
		};

		ixmaps.setLoading = function(){
			ixmaps.showLoading("... caricando ...");
		};

		// --------------------------------
		// p a g e 
		// --------------------------------

		// enumerate sections, slides and theme
		// and create the right id's for fullpage slide handling
		// -----------------------------------------------------
		var section = 0;
		$(".section").each(function(){
			$(this).attr("id","section"+(++section));
			var slide = 0;
			$(this).find(".slide").each(function(){
				$(this).attr("id","section"+section+"slide"+(++slide));
				$(this).find(".theme").each(function(){
					$(this).attr("id","theme_"+section+""+slide);
				});
			});
		});

        // CUSTOM SCROLL SCRIPT FUNCTION FOR NAVBAR
        $(function () {
            $('.scrollclass a').bind('click', function (event) { //just pass scrollclass in design and start scrolling
                var $anchor = $(this);
                $('html, body').stop().animate({
                    scrollTop: $($anchor.attr('href')).offset().top
                }, 1000, 'easeInOutQuad');
                event.preventDefault();
            });
        });
       //ADD REMOVE PADDING CLASS ON SCROLL
        $(window).scroll(function () {
            if ($(document).scrollTop() > 40) {
                $(".navbar-fixed-top").addClass("navbar-pad-original");
            } else {
                $(".navbar-fixed-top").removeClass("navbar-pad-original");
            }
        });

		var html = '<a href="javascript:$.fn.fullpage.moveSectionDown();"><div class="row scrollclass fp-controlArrow fp-down" style="left:'+(window.innerWidth/2-33)+'px;text-align:center;margin-top:-0.7em;margin-bottom:1em;"></div></a>';
		$('.down').append(html);

		var html = '<a href="javascript:$.fn.fullpage.moveSectionUp();"><div class="row scrollclass fp-controlArrow fp-up" style="left:'+(window.innerWidth/2-33)+'px;text-align:center;margin-top:-2.2em;margin-bottom:3em;margin-left:1em"></div></a>';
		$('.up').append(html);

		$(document).ready(function() {

			var __section = null;
			var __slide = null;
			var __fMoveActive = false;

			var __onChange = function() {
				
				if ( !ixmaps.initialized ){
					setTimeout("ixmaps.onChange()",100);
					return;
				}
				if ( ixmaps.fMoveToSection ){
					ixmaps.fMoveToSection = false;
					return;
				}
				__doTheme("theme_"+__section+(__slide+1));	
			};

			ixmaps.onChange = function(){
				__onChange();
			};
			
			$('#fullpage').fullpage({
				'scrollOverflow': true,
				'scrollOverflowOptions':{
					scrollbars:false
				},
				'verticalCentered': false,
				'css3': true,
				//'sectionsColor': ['#888888', '#4A6F81', '#B14A4A'],
				'navigation': true,
				'navigationPosition': 'right',
				'navigationTooltips': ['Incidenti', 'Analisi temporali', 'Pericolosità', 'Natura del incidente','Attribuzioni'],

				'afterLoad': function(a,index,c,d){
					__section = index;
					__slide = 0;
					$.fn.fullpage.silentMoveTo(index, __slide);
				},
				'afterSlideLoad': function(a,index,c,d){
					__slide = d;
					__onChange();
				},

				'onLeave': function(index, nextIndex, direction){
				}
			});
			$('#fullpage').fadeIn( "slow");
		});

		__doThemeOldTheme = null;
		__doThemeTimeout = null;
		__doTheme = function(szName) {
			
			if ( szName == __doThemeOldTheme ){
				return;
			}
			__doThemeOldTheme = szName;
			if ( __doThemeTimeout ){
				clearTimeout(__doThemeTimeout);
			}
			__doThemeTimeout = setTimeout("__doThemeOnTimeout('"+szName+"')",100);
		}
		__doThemeOnTimeout = function(szName) {
			$("#"+szName).click();
			eval($("#"+szName).attr("href"));
		}

		// ------------------------------
		// set resize handler
		// ------------------------------
		$( window ).resize(function() {
			// refresh scrollspy !!!
			$('[data-spy="scroll"]').each(function () {  
			  var $spy = $(this).scrollspy('refresh')  
			});  
		});


		// --------------------------------------------------------------
		// define click extension to
		// check/highlight the theme button 
		// --------------------------------------------------------------

		// array to store the clicked objects for onRemoveTheme callback
		var clickA = new Array(0);

		// store the last clicked object for onNewTheme callback
		var lastClicked = null;
		$("a").click(function () {
			if ( String($(this).attr("href")).match(/newtheme/i) ||
				 String($(this).attr("href")).match(/loadProject/i)
			   ){
				lastClicked = $(this);
			}
		});

		// -----------------------------------
		// adapt legend background to map type
		// -----------------------------------

		/**
		 * set legend background on map type change
		 * @type void
		 */
		__changeCss = function(className, classValue) {

			var cssMainContainer = $('#css-modifier-container');
			if (cssMainContainer.length == 0) {
				var cssMainContainer = $('<style id="css-modifier-container"></style>');
				cssMainContainer.appendTo($('head'));
			}
			cssMainContainer.append(className + " {" + classValue + "}\n");
		};

		ixmaps.htmlgui_setMapTypeBG = function(szId){

			$("#css-modifier-container").remove();

			if ( szId.match(/dark/i) || szId.match(/black/i) ){
				__changeCss(".story-body", "background-color:rgba(25,25,25,0.3)");
				__changeCss(".inline-legend", "background-color:rgba(25,25,25,0.7)");
				__changeCss(".title", "background-color:rgba(25,25,25,0.7)");
			}else{
				__changeCss(".body-story", "background-color:rgba(255,255,255,0.1)");
				__changeCss(".inline-legend", "background-color:rgba(255,255,255,0.5)");
				__changeCss(".title", "background-color:rgba(255,255,255,0.5)");
			}
		};


		// define some helper for the sidebar menu

		ixmaps.moveSectionsDown = function(nr){
			nr = nr || 1;
			for ( var i=0; i<nr; i++ ){
				setTimeout("$.fn.fullpage.moveSectionDown();",i*100);
			}
		};

		ixmaps.moveToSection = function(nr,slide){
			ixmaps.fMoveToSection = true;
			$.fn.fullpage.silentMoveTo(nr,slide);
		};

		ixmaps.moveSlideRight = function(nr){
			nr = nr || 1;
			for ( var i=0; i<nr; i++ ){
				setTimeout("$.fn.fullpage.moveSlideRight();",i*100);
			}
		};

		// load themes script
		// and initialize map if all loaded
		//
		$.when(
			$.getScript( "./index.js" ),
			$.getScript( "./statistics.js" ),
			$.getScript( "./inline_legend.js" ),
			$.Deferred(function( deferred ){
				$( deferred.resolve );
			})
		).done(function(){
			// ------------------------------
			// initialize map
			// ------------------------------

			ixmaps.waitForMap(null, function(map) {
				
				ixmaps.initialized = true;

				map.setMapTypeId("white");
				
				map.setLocalString("... processing ...", "");
				map.setLocalString("... creating theme ...", "");
				map.setLocalString("cleaning up ...", "");
				map.setLocalString("processing data ...", "&#9881;");
				
				map.setLocalString("loading data ...", "data &#x2B73;");
				map.setLocalString("aggregated", "&#9881;");
				map.setLocalString("please wait ...", "&#9881;");
				map.setLocalString("drawing", "&#9881;");
				map.setLocalString("do selection", "");
				map.setLocalString("...", "");

				mymap = map;
				
				map.loadProject("https://raw.githubusercontent.com/gjrichter/viz/master/Madrid_II_dyn/projects/Madrid_final_dyn/intro/ixmaps_project_Barrios_Population_and_Trees.json");
				
			});

		}).fail(function(){
			alert("script loading "+arguments[2].toString());
		});

	</script>


</body>
</html>
